import tools
import binascii
import struct
import tools

"""
#  Block #542213
#  https://blockstream.info/block/000000000000000000143a2c56c0214236dadfd30df41d4a0345492ad6d861ec?expand

$ reverse_endian 66beaceb4be99da1e9824448231ab4fd37bacaee912381e779b37cf0e1dadad7
d7dadae1f07cb379e7812391eecaba37fdb41a23484482e9a19de94bebacbe66

$ reverse_endian aecb37e25954e15489e25548eb663ffdfd8a1362cac757ad62e9614453d2a577
77a5d2534461e962ad57c7ca62138afdfd3f66eb4855e28954e15459e237cbae

$ reverse_endian 5b211bc589cbdf5ad86cab1e2fe91f01c8ab934d21536b35864d30a3ff778456
568477ffa3304d86356b53214d93abc8011fe92f1eab6cd85adfcb89c51b215b

$ hash256 0000000000000000000000000000000000000000000000000000000000000000d7dadae1f07cb379e7812391eecaba37fdb41a23484482e9a19de94bebacbe66
d822d7717f284b89ea6a97874af567e9887a26a9f7db449ce02377d8fae4643f

$ hash256 77a5d2534461e962ad57c7ca62138afdfd3f66eb4855e28954e15459e237cbae568477ffa3304d86356b53214d93abc8011fe92f1eab6cd85adfcb89c51b215b
c182a158773ea7fc7a252fa725fc726de2a171088b40528ca00de0569fe53afe

$ hash256 d822d7717f284b89ea6a97874af567e9887a26a9f7db449ce02377d8fae4643fc182a158773ea7fc7a252fa725fc726de2a171088b40528ca00de0569fe53afe
30d002641e0eb81b11c3d14f4b120e80b4c06bcb3d34d90a5a606ca85e90c841

$ hash256 30d002641e0eb81b11c3d14f4b120e80b4c06bcb3d34d90a5a606ca85e90c8410000000000000000000000000000000000000000000000000000000000000000
4a657fcaa2149342376247e2e283a55a6b92dcc35d4d89e4ac7b74488cb63be2
"""





# https://www.blockchain.com/explorer/blocks/btc/000000000000000000143a2c56c0214236dadfd30df41d4a0345492ad6d861ec
"""primeiro = "66beaceb4be99da1e9824448231ab4fd37bacaee912381e779b37cf0e1dadad7"
primeiro = (bytes.fromhex(primeiro)[::-1]).hex()

segundo = "aecb37e25954e15489e25548eb663ffdfd8a1362cac757ad62e9614453d2a577"
segundo = (bytes.fromhex(segundo)[::-1]).hex()

terceiro = "5b211bc589cbdf5ad86cab1e2fe91f01c8ab934d21536b35864d30a3ff778456"
terceiro = (bytes.fromhex(terceiro)[::-1]).hex()

tmp = ("00" * 32) + primeiro
print(tmp)
c_1 = tools.sha256_double_hash(binascii.unhexlify(tmp), invert=False)
print(c_1)

tmp = (segundo + terceiro)
print(tmp)
c_2 = tools.sha256_double_hash(binascii.unhexlify(tmp), invert=False)
print(c_2)

tmp = (c_1 + c_2)
print(tmp)
c_3 = tools.sha256_double_hash(binascii.unhexlify(tmp), invert=False)
print(c_3)

tmp = (c_3 + ("00" * 32))
print(tmp)
c_2 = tools.sha256_double_hash(binascii.unhexlify(tmp), invert=False)
print(c_2)
       """


# block 542213
# aa21a9ed4a657fcaa2149342376247e2e283a55a6b92dcc35d4d89e4ac7b74488cb63be2
# witness 4a657fcaa2149342376247e2e283a55a6b92dcc35d4d89e4ac7b74488cb63be2
hashs = ["00" * 32, "66beaceb4be99da1e9824448231ab4fd37bacaee912381e779b37cf0e1dadad7", "aecb37e25954e15489e25548eb663ffdfd8a1362cac757ad62e9614453d2a577", "5b211bc589cbdf5ad86cab1e2fe91f01c8ab934d21536b35864d30a3ff778456"]
hash = tools.calc_markle_witness(hashs)
print(f"************* TEST HASH {'4a657fcaa2149342376247e2e283a55a6b92dcc35d4d89e4ac7b74488cb63be2' == hash}")


# minha
# witness c7863adedb3ec9b29cc79e219aedb21e4bfc3aea5fcd8760c517d8d8a8b9b2c3
hashs = ["00" * 32, "89e5a529855dc65c42f556601488f183df6d6213502652dfae91e27991d773c0"]
hash = tools.calc_markle_witness(hashs)
print(f"************* TEST HASH {'c7863adedb3ec9b29cc79e219aedb21e4bfc3aea5fcd8760c517d8d8a8b9b2c3' == hash}")

# minha
# witness a475671cfb8a42d64c54f1d02e9ebfbd58c7082d3bea860ac3b0360236dd2613
hashs = ["00" * 32, "d3746b35c794c243e3550114b0a06f2b060995ec80117567b1825472ddde4d73"]
hash = tools.calc_markle_witness(hashs)
print(f"************* TEST HASH {'a475671cfb8a42d64c54f1d02e9ebfbd58c7082d3bea860ac3b0360236dd2613' == hash}")


# minha - CORRIGIR COM PAR
# witness 53ace8b55a2bc6fbc2f095dffa2ffc124c5165a8ed7f4d4be00cb4b5d589d4d2
hashs = ["00" * 32, "db915752b1787d4c81de6ec9e802492d71ffcebca970fcb25d2960620a69a1b2", "201959054f6b7d786eba7bc323e1991b0de42e914c97192c66bbd10af615c0b3", "a3851be31cedd132e160b3fbd943a8f89e9d084a7ed157897daa93b484e2a681", "d3746b35c794c243e3550114b0a06f2b060995ec80117567b1825472ddde4d73"]
hash = tools.calc_markle_witness(hashs)
print(f"************* TEST HASH {'53ace8b55a2bc6fbc2f095dffa2ffc124c5165a8ed7f4d4be00cb4b5d589d4d2' == hash}")


# minha - CORRIGIR COM PAR
# witness 7b5541aa4d28dc3c37fc89c6da97fae70645b551db37644a17d4b74eb5268a15
hashs = ["00" * 32, "db915752b1787d4c81de6ec9e802492d71ffcebca970fcb25d2960620a69a1b2", "26ea034080eb9f1b8f08020fc898cef88ee2b22c9eed24954758174cc97bc5c2", "201959054f6b7d786eba7bc323e1991b0de42e914c97192c66bbd10af615c0b3", "a3851be31cedd132e160b3fbd943a8f89e9d084a7ed157897daa93b484e2a681", "d3746b35c794c243e3550114b0a06f2b060995ec80117567b1825472ddde4d73"]
hash = tools.calc_markle_witness(hashs)
print(f"************* TEST HASH {'7b5541aa4d28dc3c37fc89c6da97fae70645b551db37644a17d4b74eb5268a15' == hash}")

# minha - 6a24aa21a9edd9cec79475935de059590d7a1fc38ebedf9d2d20edd18ecd0fc2efcd20ca2416
# witness d9cec79475935de059590d7a1fc38ebedf9d2d20edd18ecd0fc2efcd20ca2416
hashs = ["00" * 32, "db915752b1787d4c81de6ec9e802492d71ffcebca970fcb25d2960620a69a1b2", "26ea034080eb9f1b8f08020fc898cef88ee2b22c9eed24954758174cc97bc5c2", "201959054f6b7d786eba7bc323e1991b0de42e914c97192c66bbd10af615c0b3", "6d2f55293bc4cbab01631bfa0ac45aec8f3c667f3e3d45032e0b54a440c9b0b7", "a3851be31cedd132e160b3fbd943a8f89e9d084a7ed157897daa93b484e2a681", "d3746b35c794c243e3550114b0a06f2b060995ec80117567b1825472ddde4d73"]
hash = tools.calc_markle_witness(hashs)
print(f"************* TEST HASH {'d9cec79475935de059590d7a1fc38ebedf9d2d20edd18ecd0fc2efcd20ca2416' == hash}")


# https://blockstream.info/block/00000000000000000001a0c33308d77536919afeaa382f0a3dac6cb4b0b12d38
# aa21a9ed2d4d74852b368fa1b9cc4e5bc6314136376a7bd17ddcd33bda989aa9c7ffbd1b
# witness 2d4d74852b368fa1b9cc4e5bc6314136376a7bd17ddcd33bda989aa9c7ffbd1b
"""
hashs = [
         "00" * 32,
         "6cc35f24fb7ed2e305062bf6f2c7c0417c8ea4a6879a2ce7ef5774a8d36c73ee", 
         "6f8bca7c0752f1bdb81f013c285479db4c2a9c18adaac7159e6790fa2dd498d2",
         "235fea26ab14d93b0ef474dd092e9b28b03931798cc24d4aa7e32270308bde21",
         "c720385ca96c3a941be629998bfcbc22ffa062b6e6921d14e7c97ef442a8871a",
         "29f4a2e9cb952d672d797a2af9e66dd13bcc209fe5c1e98621d582448d282388",
         "805f12b598c1a0388eb8ab99a51f74943c013c7610c969e335d42a6d87eb9cf5",
         "586b19312a7b12b13f2e00111bc1cb355651f67f6484d3d3aacbd66b78fff458",
         "4abe637c6c66193c65cead2cb85e0d45b7f46a20935d7832b336cca6a9f2d5f6", 
         "43449f023190f27327ecce2862699c0ee5bf89e744b463d46bd286c1b1a60b68",
         "9b1d7d0d6469d3123eb340f3a101627d181cf9eb08a59c0ede47e92a324d513c",
         "14a0e0a1e745ea8d6898dbeebf95ffb558e143f133ea405ab52f61ca11f40ad2",
         "f93930bdc241cc1b40ae214906e8186da52343ea7909dca0c8abef7116975205",
         "c5c8b99f4a301fe82a07e564a482f01c9f8bfe616db8b2d98ddb802a4a24336d",
         "937c90ae4853158bcdf5b8137805fcde1ac2be84aeb362845323b7c2095f5199",
         "c5e28fb634b03404d6790bd4d8726d2ad1d756f3cb68704e708dad9b718acd70", 
         "8726c2bfca7496af75fc89ccea7b012d3c6929caeff8f456aee7e4ee97447556",
         "c557bd52dae27242e90c8383589c1fe39e6012593fa0130430973d7378cf1fc8",
         "0d62be4f1f0fed4cf03971f8cb85ded2f333bf67c67f8454d80eaced88e1ecb6",
         "ef9082532ffc64f1fefcf700500547ab9d5d4653a89f43247492d106c54aed02",
         "437e5ae5958f141436fbf6b5c0a679bdb294dc085b2147d5f743a26b72e8d1d8",
         "b99ba0c30a474373a2248b2f9942eef6d9437fdca0a0c53a73b5e5b5bf60ecd0",
         "d393540c1067317da752d28a6e142f799707453a9a808f7b47ea149409909f51", 
         "359c4aa67ee8e516e9ae291bcb186c229ae96872cae9d7b15e40f095e50aed60",
         "e80e4e270c9691ee3a2917cf41d02926ad947e0d9b603323fcfef1726b44e960",
         "ba459f5174473006d20ebccc17c19c789c08241a6c5c3a8d8e37a3a43430ee53",
         "a23232ee277df113603a6aeea112e9714c76ed8125d4bcf6bd9890295ce455f4",
         "7007c55590cc370688ce53488c960250ff3375a0fdb06a02f315e7c62a658d10",
         "845524d558d2396759a2767276e35ff223c8b742003e18afa15428683a26102c",
         "6dd2e913e8a6dbc845f51a06222241bcd44bd5b7d0e31afb2716837bae771634", 
         "86a93675deca41f48d1a4ec0bcda812ce440977ee77e202a1fc43c5d33bc4f5d",
         "ce5c7f40127241c0904e8e6faf86ec9d6d6092c581d19b6741841334a866d666",
         "7d9b1d13e0be74e9ed7d7d140efe0caf502cabb1a7d90e1d04529e3bba1ae58d",
         "5aec0f33a237a5def18480965dd4b538a7cf6a5be71ee4880f139ac773fb06a9",
         "4356ddae2ca1972fe98725d61fbd2283c6c0a38da55d4d565d3e1f298edc33b2",
         "12a3e249dc4c969d761759c7d936ddb4c3126b1e848d385195bc83bf228430cd",
         "19fa8ddaefdad0f47a56adfa82b9e459e2d4dda8177a206309297309b49354d6", 
         "62acb976a6961d624fa74c13d487cbaf922eb73c6a48e62299c8ed1f517ed9da",
         "21023c694e7d07ebd8614b1ac281da2b4ba93a56828cf42c6be9c4f8d9718de0",
         "f1e7fd48d6356800d8fe224c6d0ff948b78b3364061beaa250441a462b5cd1cd",
         "f04f5dcb94525b5a99193992b37b58b700c3e51cabea3ce2583c00023c4ae5d0",
         "c6c26f691e6e8a5805498502d209f4d6f0ad6306bcf6a5e239e9195731aa13f0",
         "948183970384d4cf8111dc2766288ca6a7e7fdc4663e0931746a90de0874e463",
         "046678b091fa51ec3e9362fc2847206821e0ac189fe001fd41e4c5a2b1e33a0b", 
         "20624786f7fd78dbd17853a55eb997e48a1a0a8ff8b37f903faf2dc04f1bb353",
         "620ad0f32d0d3d034baa9faf8bee3320e75e6af2e1894b2e268f5b43906047ae",
         "ad7946e426db8b7734e06b7819d6a04291b75b39ad45790de816f6edad5315ee",
         "5013987d0ddfe46608fd1dbc263155320326f84059935a7069be7922b8ae9fb2",
         "bcf3c1895b7955a977d26fe706f4e19ef1c138dfc2c0086664bf134f41ee8fa9",
         "2ee5b9b63f8569423599db77978039c92316f1d28111c41d035295e4d5e02455",
         "26adb98a19a1720b86e86c0f3d7d9b9a2ed94683ef2b8b0c7e4d9917fff56f09", 
         "dc0f282ec2b8d9ffcac2c08a0acc37e5549dae59c0bf33a09da923ef4223723b",
         "99052cba6ead23d855a1c8929b7c738a5539a86c5a031718a340cd2b6edc68a6",
         "f4d5f5e9406bd1573270e8df8594b1cf0a9c99d4a1c631c0b7853bb071841353",
         "5a512fa65c48234ba1badd5f16d1a21ac94ffedf52492ae7483abcddbdb331ca",
         "0fe0acc50c8aaa92c85c35f32b087b45083f177dd4ecdbd6c304b821faf68d56",
         "dc04ec6319b2309630063177ecc28329d9facd23424f28b1683887492ba913f6",
         "ee2c43071da2fa22e28113224cf3af91950d448eb360f6848d53f249ae95ab7c", 
         "8f039c6da4261f27a35e922a0868963ca621bd7951e043bb3a47e7af54e25ed5",
         "ff6c6fd5ba53d0461aac679d7476e2695c81ece502aa8deb7e0f8005aacd06dc",
         "95b5030e1c45a3513312773006eae14148ae152b8a805899ce4d22dc743e9733",
         "83323ee3438f32e0195e625e7a3ddd69cbe0832d1ff40c3bf81ebf781bc0151a",
         "4382e0eb4b0d4cb441225a6aac526ba3bcd5bf92cc3f050d3b5dda34721a4ee8",
         "938182e12e8666b57ca3ff69417edc8ad5a1f9383616a679a81ff550078836ce",
         "3f2cc3deff62adf66313798cd415f6744dc7c0cad8c2cfafacbef17038046e0a", 
         "d3c174517f48e017f1b17a81fee775101145d5fb0cdaf2475f473fe4a5b99055",
         "fbbaf8fed50365ad3ba8d3ab4c65520806459719636694aa07ab72720e704d8e",
         "2c27d2bce5c4d61030bd02e3bd73d9155167670e3356475842dc248c4756b9a3",
         "89f8d609fc5c26ecd23d90f018789c511575fba103a1bfc43c6fb549e5a69c0f",
         "03cd91e6fa95e9f1a516aed09237634c42b076e369a6bbbd8132af7ebceffd41",
         "5b57b7eede847c8691d838b6f703389298668496085435241429f1bbb53b448a",
         "1be4c4ac9f2351aa3be18457e9cf0faec2b2f4b1c3bdf523762c0fafefc8d070", 
         "5fee60bf4972774350f169e667690c52c97ab6cb48d0e0792d7d96022c26b8cb",
         "8035bc3b71c4ce5e8475f661240c44efef47c43e337bcfc2038f02d4ffc14b10",
         "18333f5c02cdc226bba09f17d696835c2943fb3dcc890de9b24760948f74312f",
         "b18595eca48b2183ab593f455fb0ce3418b90d4c40d42bd1939f169621683478",
         "3ac469b8fefde413b5f367fa7a2a9c810fc65a2deaeb93f9a060d4e766360ada",
         "563cf346382b3faaa32ceba748890c6b1d7adec9c39048a4959c42b72b788666",
         "f20a7f2262ff59d2213c89a896f07c4784fc98ea92cc27abf36269ea147aabba", 
         "ea144c4d9d5cf4ee0a6096fa5de7012281d05849f10860380560ba65a1105b6f",
         "5c1ff5db9f38e704efc355604a13e4b401bec486faa27cc59e9e48449a092c68",
         "a3036465cba8444150c71540344528db85fc26cf4958f9695b9e5dfb1bdc1587",
         "089af42c229360b861e38c6075490e13a8e699924b35060308a54d10e72b21ff",
         "04c30c537dbda315e76988590374b2bdd6dc689f5af46611e8972651591fa580",
         "2597e9320c1d45393d8093b1046220d235e6b90a54b169739e2cb8d0814bc540",
         "18df0fae9228154b7fcdfebd247b266877283c6cf95df579e6e1f21932d890aa", 
         "56502a4dd962e906016764d1bd15994c0a6f2eec1215dde6adf4ebefdcf5a129",
         "4c3ae4ed585b0be05595c486e893132d3110842e65aa9d8105b8d17dd995ce11",
         "cd3862b644f131918cf9998f5f2eca036e81c151969b90a6b57db86e3d756472",
         "d9019e0e6920f9bfda58213d7b039ac0fc3cdc979ec7c09363592a0b496d155f",
         "7723cf6eba1e383433d66e9be1efd216736aaa488ed4be948053eac93141eac8",
         "381b70b7f403129fe63cdc2482886974c2f3aa5c1bea0d520942298968bf5404",
         "5e7481d3db24dbe42a36e1c27ab94822fbf4b7551d4211802aea943b90f496f3", 
         "bfd0216f7377f81bcf18741a774d74435e8d4a4dd8a266c79fecdcb31484debe",
         "b8a7b448dc37a92eb8a06860ee25c6f96208cf9cac7fe8fec2da66c60c8ea2a3",
         "a1179d43cc470ea41e1779b914f7bd17f6d28f8aa31f2aa7e0aeda7861b4caa0",
         "33595cc4242fff1db94b9bf0e766aaaf2b82c17c8f3ce85a1a1c1e8d1aac756f",
         "36e0a1ba1abf188f5124fdcbed9ff32a917c118ffb0b9247754e8f18133cf760",
         "2dfe9afacc93f3cb20b802199e968edde83f3a04b69f2dbe12ff8a1f66e2056a",
         "b329cecbc5f96648082cde1941b22e52792050d924b98e3bdb3eb14b98b1d86c", 
         "a7b3794cb4b984b94c3cb0134c17212f47828411a6d6e29a6d9e0780afb11e72",
         "82c69e648a37df490b5e872bc714fbac163f3bf736f1dd80ce858fb3a2d07775",
         "9becbc68a25232975a6b8e20aaf5d3303d05b58c2c8fbd3820ed109ddaacbc88",
         "c11ad8b3dd73be89a49cdb83a7c384bf92b41bd6d291ca0e46c0109148f2fe90",
         "998968adcb19e7cc018a7228a73e58fc1eaec9ed1040943a99f2d98e027f3f9b",
         "b585e10ca84b39ef13d7ee419a582b6967121dfe7b63236466204063afbeb6ae",
         "552b966264ea7b317401b85c8308aeca3a17e842e7314dc5db95feb835c616c8", 
         "c462bdb544f5a7ddbc92ac2689330a4d8e0f890d9a1c0978ddefde3c32615715",
         "31391a3136a1a072cf281433c47e75e43918681e680b92bb0159e3810b4645e7",
         "46a47d7b2e6168848af02cfe797ea3ddd58d599125705044c82ab93263a7cbe8",
         "e7a624fa60c87758c51f5671405f4aa523f25706e4f6e44da338f5d4c82477fd",
         "1e24f9dcf3a7b6c379db8808224bc4de953459d32668e562200ea8227a0edf02"]

hash = tools.calc_markle_witness(hashs)
print(f"************* TEST HASH {'2d4d74852b368fa1b9cc4e5bc6314136376a7bd17ddcd33bda989aa9c7ffbd1b' == hash}")
"""


"""     
primeiro = "89e5a529855dc65c42f556601488f183df6d6213502652dfae91e27991d773c0"
primeiro = (bytes.fromhex(primeiro)[::-1]).hex()

tmp = ("00" * 32) + primeiro
print(tmp)
c_1 = tools.sha256_double_hash(binascii.unhexlify(tmp), invert=False)
print(c_1)

tmp = (c_1 + ("00" * 32))
print(tmp)
c_2 = tools.sha256_double_hash(binascii.unhexlify(tmp), invert=False)
print(c_2)

hashs = [("00" * 32), "89e5a529855dc65c42f556601488f183df6d6213502652dfae91e27991d773c0", ("00" * 32)]

print(tools.calc_merkle_root(hashs))
"""